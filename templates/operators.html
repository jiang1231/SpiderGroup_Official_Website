{% extends "base.html" %}
{#{% block title %}爬虫组{% endblock %}#}
{% block body_attribs %}
{% endblock %}
{% block head %}
    <link href="{{ url_for('static', filename='css/mycss/dishonest.css') }}" type="text/css" rel="stylesheet">
{{ super() }}
{% endblock %}
{% block page_content %}
    <div class="container">
    <div class="row">
        <div class="col-md-10 col-lg-offset-1">
            <form class="my-form form-horizontal" id="searchForm" >
                <p style="padding: 10px 0px 10px 20px;color: #f1f3f5"> <strong><span style="font-size: 30px;color: #1abc9c">运</span>营商查询 </strong></p>
                <div class="my-input">
                <div class="form-group" style="display: inline-block;">
                    <label class="col-sm-4 control-label">手机号:</label>
                    <div class="col-sm-8">
                        <input type="text" id='content' name="content" class="form-control"/>
                    </div>
                </div>
                <div class="form-group" style="display: inline-block;">
                    <label class="col-sm-4 control-label">密码:</label>
                    <div class="col-sm-8">
                    <input type="password"id="password" name="password" class="form-control"/></div>
                </div>
                <div class="form-group" style="display: inline-block;"id="vcode-div">
                    <label class="col-sm-4 control-label" id="vcode-label"></label>
                </div>
                <div class="form-group" style="display: inline-block;">
                <div class="col-sm-offset-2 col-sm-6">
                    <a role="button" class="btn btn-primary" id="searchButton" > 查询 </a>
                </div>
                    </div>
                    </div>
            </form>
            <div id="checkNumber">
            </div>
        </div>
    </div>

    <div class="row">
        <div id="result" class="col-md-10 col-lg-offset-1">
        </div>
    </div>
    </div>

    <script>
    $(document).ready(function() {
        $("#content").change(function () {
            try {
                var x = $("#content").val();
                if(x == "") throw "请输入手机号";
                if(isNaN(x)) throw "输入错误，请输入数字";
                if(x.length != 11) throw "手机号位数有误,请重新输入";
            }
            catch (err) {
                 $("#content").attr('style', 'border-style: solid;border-color:red;');
                 $("#checkNumber").append('<p style="text-align: center;margin-top: 20px;">'+err+'</p>');
                 return;
            }
            $("#searchButton").attr('disabled', true);
            $.get('/check_phone_number/'+$("#content").val(), function (data, status) {
                data = JSON.parse(data);
                $("#searchButton").attr('disabled', false);
{#                alert(typeof data.company);#}
                if (data.company === 1) {
                    $("#vcode-label").empty();
                    $("#vcode-father").remove();
                    $("#checkNumber").empty();
                    $("#checkNumber").append('<p style="text-align: center;margin-top: 20px;">' +
                            '欢迎您，'+data.province+ data.city+'联通用户'+$("#content").val()+'！！</p>');
                }
                else if (data.company === 2) {
                    $("#vcode-label").empty();
                    $("#vcode-father").remove();
                    $("#vcode-label").append('验证码:');
                    $("#vcode-div").append('<div class="col-sm-8" id="vcode-father"><input type="password"id="vcode" name="vcode" class="form-control"/></div>');
                    $("#checkNumber").empty();
                    $("#checkNumber").append('<p style="text-align: center;margin-top: 20px;">欢迎您，移动用户'+$("#content").val()+'！！</p>');
                }
                else if (data.company === 3) {
                  $("#vcode-label").empty();
                    $("#vcode-father").remove();
                    $("#checkNumber").empty();
                    $("#checkNumber").append('<p style="text-align: center;margin-top: 20px;">欢迎您，联通用户'+$("#content").val()+'！！</p>');
                }
                else {
                    $("#checkNumber").empty();
                    $("#checkNumber").append('<p style="text-align: center;margin-top: 20px;">号码'+$("#content").val()+'有误，请确认后重新输入！！</p>');
                }
            })
        })
        $("#password").change(function () {
{#            $("#vcode-label").empty();#}
{#            $("#vcode-father").remove();#}
        })
        $("#searchButton").click(function () {
            if($("#content").val()&&$("#password").val()){
            $("#searchButton").attr("disabled", true);
                if($("#vcode").val() == undefined){
                    $.get('/get_data_union/'+$("#content").val()+'/'+$("#password").val(), function (data, status) {
                        if(data === 'error'){
                            //服务端返回error
                            alert('查询错误，请检查帐号密码后重试');
                        }
                        else {
                            //查询成功
                            $("#result").html(data);
                        }
                        $("#searchButton").attr("disabled", false);
                    })}
                else {
                    $.get('/get_data_mobile/'+$("#content").val()+'/'+$("#password").val()+'/'+$("#vcode").val(), function (data, status) {
                        if(data === 'error'){
                            //服务端返回error
                            alert('查询错误，请检查帐号密码后重试');
                        }
                        else {
                            //查询成功
                            $("#result").html(data);
                        }
                        $("#searchButton").attr("disabled", false);
                    })
                }
                    }
            else {
                if(!$("#content").val())
                    $("#content").attr('style', 'border-style: solid;border-color:red;');
                if(!$("#password").val())
                    $("#password").attr('style', 'border-style: solid;border-color:red;');
            }
        })
    })
    </script>
{% endblock %}
