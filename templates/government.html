{% extends "base.html" %}
{% block title %}政府机构查询{% endblock %}
{% block body_attribs %}
{% endblock %}
{% block head %}
{{ super() }}
    <script>
    $(document).ready(function(){
        $.post("{{ url_for('get_area') }}",
        {
            type:"province",
            name:"all"
        }, function(data, status){
                    data = eval(data);
                    for (var i of data){
                        $("#dopProvince").append("<option value='" + i + "'>" + i + "</option>");
                    }
        });

        //当省份改变的时候
        $("#dopProvince").change(function() {
            var id = $("#dopProvince").val();
                $.ajax({
                    type: "POST",
                    url: "{{ url_for('get_area') }}",
                    data: { type: "city", name: id },
                    success: function(data) {
                        if (data == "fail") {
                            alert("loading failed");
                        }
                        else {
                            data = eval(data)
                            $("#dopCity").empty();
                            $("#dopCity").append("<option value=''>市区</option>");
                            for (var i of data){
                                if(i =='')
                                    $("#dopCity").append("<option value=''>" + i + "</option>");
                                else
                                    $("#dopCity").append("<option value='" + i + "'>" + i + "</option>");
                            }
                        }
                    }
                });
        });

        //当城市改变的时候
        $("#dopCity").change(function() {
            var id = $("#dopCity").val();
                $.ajax({
                    type: "POST",
                    url: "{{ url_for('get_area') }}",
                    data: { type: "sub_city", name: id },
                    success: function(data) {
                        if (data == "fail") {
                            alert("loading failed");
                        }
                        else {
                            data = eval(data);
                            $("#dopSubCity").empty();
                            $("#dopSubCity").append("<option value=''>县镇</option>");
                            for (var i of data){
                                if(i =='')
                                    $("#dopSubCity").append("<option value=''>" + i + "</option>");
                                else
                                    $("#dopSubCity").append("<option value='" + i + "'>" + i + "</option>");
                            }
                        }
                    }
                });
        });


        //当城市改变的时候
        $("#dopSubCity").change(function() {
            var id = $("#dopSubCity").val();
                $.ajax({
                    type: "POST",
                    url: "{{ url_for('get_area') }}",
                    data: { type: "town_street", name: id },
                    success: function(data) {
                        if (data == "fail") {
                            alert("loading failed");
                        }
                        else {
                            data = eval(data);
                            $("#dopStreet").empty();
                            $("#dopStreet").append("<option value='街道'>街道</option>");
                            for (var i of data){
                                if(i =='')
                                    $("#dopStreet").append("<option value=''>" + i + "</option>");
                                else
                                    $("#dopStreet").append("<option value='" + i + "'>" + i + "</option>");
                            }
                        }
                    }
                });
        });
    //点击查询
        $(".btn-primary").click(function () {
            $.post("{{ url_for('get_mess') }}",
                    {
                        province: $('#dopProvince').val(),
                        city: $('#dopCity').val(),
                        sub_city: $('#dopSubCity').val(),
                        town_street: $('#dopStreet').val(),
                        content: $('#content').val()
                    },function (data, status) {
                        $('#result').empty();
                        $('#result').append(data);
                    })
        })
    })
    </script>
    <style>
          .my-form {
        -moz-box-shadow: 5px 5px 5px #888888; /* 老的 Firefox */
{#        box-shadow: 4px 4px 4px #888888;#}
        top: 80px;
        background-color: #34495e;
        border-radius: 12px;
    }
    div.my-input {
        background-color: #dadcde;
        padding-top: 30px;
        padding-left: 10px;
        border-radius: 0px 0px 10px 10px;
    }
    </style>
{% endblock %}
{% block page_content %}
    <div class="container">
    <div class="row">
        <div class="col-md-12">
            <form id="searchForm" class="my-form">
                <p style="padding: 10px 0px 10px 20px;color: #f1f3f5"> <strong><span style="font-size: 30px;color: #1abc9c">政</span>府机构查询 </strong></p>
                <div class="my-input">
                <select id="dopProvince" data-toggle="select" class="form-control select select-inverse mrs mbm" name="province">
                    <option value=''>省份</option>
                </select>
                <select id="dopCity" data-toggle="select" class="form-control select select-inverse mrs mbm" name="city">
                    <option value=''>市区</option>
                </select>
                <select id="dopSubCity" data-toggle="select" class="form-control select select-inverse mrs mbm" name="sub_city">
                    <option value=''>县镇</option>
                </select>
                <select id="dopStreet" data-toggle="select" class="form-control select select-inverse mrs mbm" name="town_street">
                    <option value=''>街道</option>
                </select>
                <input style="display: inline-block;position: relative;width: 140px" class="form-control" type="text" id='content' name="content"/>
                <a role="button" class="btn btn-primary" > 查询 </a>
                </div>
            </form>

        </div>
    </div>

    <div class="row" style="margin-top: 50px">
        <div id="result" style="padding-left: 20px;padding-right: 20px;">
        </div>
    </div>
    </div>
{% endblock %}
